{% extends "base.html" %}

{% block title %}Your Profile - DevCheatHub{% endblock %}

{% block content %}
<div class="container">
    <div id="profile-view-mode" class="form-section">
        <div class="profile-view-header">
            <img class="profile-picture" src="{{ user.profile.avatar_url }}" alt="Profile Picture">
            <div class="profile-view-info">
                <h1 class="profile-username">{{ user.username }}</h1>
                
                {% if user.get_full_name %}
                    <p class="profile-fullname">Full name: {{ user.get_full_name }}</p>
                {% endif %}

                <p class="profile-email">Email: {{ user.email }}</p>
                <button id="edit-profile-btn" class="btn btn-secondary">Edit Profile</button>
            </div>
        </div>

        <div class="profile-view-body">
            <h3>Bio</h3>
            <p class="profile-bio">{{ user.profile.bio|default:"You haven't added a bio yet." }}</p>
            <h3>Social Links</h3>
            <div class="profile-socials">
                {% if user.profile.github_url %}
                    <a href="{{ user.profile.github_url }}" target="_blank" class="social-link">GitHub</a>
                {% endif %}
                {% if user.profile.linkedin_url %}
                    <a href="{{ user.profile.linkedin_url }}" target="_blank" class="social-link">LinkedIn</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="profile-edit-mode" class="form-section" style="display: none;">
        <h2 class="form-section-title">Update Profile</h2>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group">
                {{ u_form.username.label_tag }}
                {{ u_form.username }}
                {% if u_form.username.errors %}
                    <div class="form-error">
                        {% for error in u_form.username.errors %}
                            <p class="error-text">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="form-group">
                {{ u_form.email.label_tag }}
                {{ u_form.email }}
                {% if u_form.email.errors %}
                    <div class="form-error">
                        {% for error in u_form.email.errors %}
                            <p class="error-text">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group">
                {{ u_form.first_name.label_tag }}
                {{ u_form.first_name }}
            </div>
            <div class="form-group">
                {{ u_form.last_name.label_tag }}
                {{ u_form.last_name }}
            </div>
            
            {% comment %} <hr class="separator-light"> {% endcomment %}

            <div class="form-group">
                {{ p_form.bio.label_tag }}
                {{ p_form.bio }}
            </div>
            <div class="form-group">
                <label>Profile Picture</label>
                <div class="custom-image-upload">
                    <img id="image-preview" src="{{ user.profile.avatar_url }}" alt="Current profile picture">
                    <div class="upload-actions">
                        <label for="id_profile_picture" class="btn btn-secondary">Change Picture</label>
                        {% if user.profile.profile_picture and user.profile.profile_picture.url != "/media/profile_pics/default.svg" %}
                            <button type="button" id="remove-pic-btn" class="btn btn-danger">Remove</button>
                        {% endif %}

                        <div class="clear-checkbox-group" style="display: none;">
                            {{ p_form.profile_picture.clear }}
                            {{ p_form.profile_picture.clear_checkbox_label }}
                        </div>
                    </div>
                </div>
                <div style="display: none;">
                    {{ p_form.profile_picture }}
                </div>
            </div>
            <div class="form-group">
                {{ p_form.github_url.label_tag }}
                {{ p_form.github_url }}
            </div>
            <div class="form-group">
                {{ p_form.linkedin_url.label_tag }}
                {{ p_form.linkedin_url }}
            </div>

            <div class="form-group form-actions">
                <button class="btn btn-primary" type="submit">Save Changes</button>
                <button type="button" id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>

     <hr class="separator-light">

    <div class="profile-submissions">
        <h2 class="section-title">Your Submissions</h2>
        <div class="list-container">
            {% for sheet in page_obj %}
                <div class="list-item">
                    <div class="list-item-header">
                        <h3 class="list-item-title">
                            {% if sheet.status == 'APPROVED' %}
                                <a href="{% url 'cheatsheet_detail' sheet.slug %}" class="list-item-link">{{ sheet.title }}</a>
                            {% else %}
                                {{ sheet.title }}
                            {% endif %}
                        </h3>
                        <span class="status-badge status-{{ sheet.status|lower }}">{{ sheet.get_status_display }}</span>
                    </div>
                </div>
            {% empty %}
                <p class="text-secondary">You haven't submitted any cheatsheets yet.</p>
            {% endfor %}
        </div>
        {% include 'partials/pagination.html' %}
    </div>
</div>
{% endblock %}